"use strict";document.cookie="logged=false";var userIsLogin=getCookie("logged");function initEventHandlers(){$("#login").on("click",()=>{$.ajax({url:"/login",method:"get",dataType:"html",success:function(e){$(document.body).append(e),$("#authBtn").on("click",()=>{$.ajax({url:"/login",method:"post",data:{login:$("#authLogin").val(),password:$("#authPass").val(),csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){e.is_logged?($(".window__close").trigger("click"),getUserPage(e)):$(".message").text("Неверный логин или пароль").css("display","block")}})}),$("#resetPass").on("click",()=>{}),$(".window__close").on("click",()=>{$(".window__close").parent().parent().remove()})}})}),$("#register").on("click",()=>{$.ajax({url:"/register",method:"get",dataType:"html",success:function(e){$(document.body).append(e),$(".window__close").on("click",()=>{$(".window__close").parent().parent().remove()}),$("#registerBtn").on("click",()=>{$("#userPass").val()==$("#userPassConfirm").val()?$.ajax({url:"/register",method:"post",dataType:"json",data:{login:$("#userName").val(),email:$("#userLogin").val(),password:$("#userPass").val(),csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){e.is_reg?(setCookie("logged",e.is_logged),userIsLogin=getCookie("logged"),$(".window__close").trigger("click"),getUserPage()):$("#message").text(e.message).css("display","block")}}):$("#message").text("пароли не совпадают").css("display","block")})}})}),$("#exit").on("click",()=>{$.ajax({url:"/exit",method:"post",data:{csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){setCookie("logged",!1),userIsLogin=getCookie("logged"),window.location.href="/",checkAuth(userIsLogin)}})}),$("#offer").on("click",()=>{$.ajax({url:"/offer",method:"get",dataType:"html",success:function(e){$(document.body).append(e),$(".window__close").on("click",()=>{$(".window__close").parent().parent().remove()}),$(".form__btn").on("click",()=>{$.ajax({url:"/offer",method:"post",dataType:"json",data:{firstName:$("#userFirstName").val(),lastName:$("#userLastName").val(),email:$("#userEmail").val(),message:$("#userOffer").val(),csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){$(".window__close").trigger("click")}})})}})}),$("#mainPage").on("click",()=>{getMainPage()}),$("#basket").on("click",()=>{getUserPage()}),$("#personalAccount").on("click",()=>{getUserPage()})}function getMainPage(){$.ajax({url:"",method:"post",dataType:"html",data:{csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){$("#main_page").html(e),getCategories("#category__list"),$.ajax({url:"/products",method:"post",dataType:"json",data:{csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){addProducts("#showcase",e.products,!1)}})}})}function getUserPage(){$.ajax({url:"/user",method:"get",dataType:"html",success:function(e){$(".main").html(e),setCookie("logged",!0),checkAuth(userIsLogin=getCookie("logged"));var t=getUserData();$("#username").text(t.username),$("#balance").text(t.balance),addProducts("#cart",t.products,!0)}})}function checkAuth(e){(e="true"==e)?($(".unlogin").css("display","none"),$(".login").css("display","block")):($(".unlogin").css("display","block"),$(".login").css("display","none"))}function getUserData(){var e;return $.ajax({url:"/user",method:"post",dataType:"json",data:{csrfmiddlewaretoken:getCookie("csrftoken")},success:function(t){e=t},async:!1}),e}function addProducts(e,t,o){for(var s=0;s<t.length;s++){var c=t[s].id,a=o?'<div style="display: none" id="'+c+'">'+c+'</div><div class="showcase__product product"><img class="product__img" src="/static/img/products/'+t[s].image+'" onerror="this.src=`/static/img/noimage.png`" alt=""><h3 class="product__name">'+t[s].productName+'</h3><p class="product__category"><span class="category__name">'+t[s].category+'</span></p><p class="product__descipt">'+t[s].description+'</p><p class="product__seller"><span>Продавец: </span><span class="product__sellername">'+t[s].seller+'</span></p><div class="product__cost cost">'+t[s].cost+'</div><div class="product__counter counter"><div id="counter__left'+c+'">-</div><div id="number'+c+'" class="counter__number">1</div><div id="counter__right'+c+'">+</div></div></div>':'<div style="display: none" id="'+c+'">'+c+'</div><div class="showcase__product product"><img class="product__img" src="/static/img/products/'+t[s].image+'" onerror="this.src=`/static/img/noimage.png`" alt=""><h3 class="product__name">'+t[s].productName+'</h3><p class="product__category"><span class="category__name">'+t[s].category+'</span></p><p class="product__descipt">'+t[s].description+'</p><p class="product__seller"><span>Продавец: </span><span class="product__sellername">'+t[s].seller+'</span></p><div class="product__cost cost">'+t[s].cost+'</div><div class="product__counter counter"><div id="counter__left'+c+'">-</div><div id="number'+c+'" class="counter__number">1</div><div id="counter__right'+c+'">+</div></div><div id="btn'+c+'"class="button buy__btn">В корзину</div></div>';$(e).append(a),minus("#counter__left"+c,"#number"+c),plus("#counter__right"+c,"#number"+c),addToCart("#btn"+c,"#"+t[s].id,"#number"+c)}}function addToCart(e,t,o){$(e).on("click",()=>{var e=+$(t).text(),s=+$(o).text();$.ajax({url:"/add_to_cart",method:"post",dataType:"json",data:{id:e,num:s,csrfmiddlewaretoken:getCookie("csrftoken")}})})}function minus(e,t){$(e).on("click",()=>{var e=+$(t).text();e>1&&e--,$(t).text(e)})}function plus(e,t){$(e).on("click",()=>{var e=+$(t).text();e<100&&e++,$(t).text(e)})}function addActionListener(e,t,o){$(e).on(t,o)}function getCategories(e){$.ajax({url:"/categories",method:"post",dataType:"json",data:{csrfmiddlewaretoken:getCookie("csrftoken")},success:function(t){for(var o=0;o<t.categories.length;o++)$(e).append('<li class="list__item">'+t.categories[o]+"</li>")},async:!1})}function getCookie(e){let t=null;if(document.cookie&&""!==document.cookie){const o=document.cookie.split(";");for(let s=0;s<o.length;s++){const c=o[s].trim();if(c.substring(0,e.length+1)===e+"="){t=decodeURIComponent(c.substring(e.length+1));break}}}return t}function setCookie(e,t,o={}){(o={path:"/",...o}).expires instanceof Date&&(o.expires=o.expires.toUTCString());let s=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let e in o){s+="; "+e;let t=o[e];!0!==t&&(s+="="+t)}document.cookie=s}window.onload=()=>{$.ajax({url:"/auth",methos:"post",data:{csrfmiddlewaretoken:getCookie("csrftoken")},async:!1,success:function(e){setCookie("logged",e.logged),userIsLogin=getCookie("logged")}}),checkAuth(userIsLogin),getMainPage(),initEventHandlers()};