"use strict";document.cookie="logged=false";var userIsLogin=getCookie("logged");function initEventHandlers(){$("#login").on("click",()=>{$.ajax({url:"/login",method:"get",dataType:"html",success:function(e){$(document.body).append(e),$("#authBtn").on("click",()=>{$.ajax({url:"/login",method:"post",data:{login:$("#authLogin").val(),password:$("#authPass").val(),csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){e.is_logged?$.ajax({url:"/user",method:"get",dataType:"html",success:function(e){$(".window__close").trigger("click"),$("#main_page").html(e),setCookie("logged",!0),checkAuth(userIsLogin=getCookie("logged"))}}):$(".message").text("Неверный логин или пароль").css("display","block")}})}),$("#resetPass").on("click",()=>{}),$(".window__close").on("click",()=>{$(".window__close").parent().parent().remove()})}})}),$("#register").on("click",()=>{$.ajax({url:"/register",method:"get",dataType:"html",success:function(e){$(document.body).append(e),$(".window__close").on("click",()=>{$(".window__close").parent().parent().remove()}),$("#registerBtn").on("click",()=>{$("#userPass").val()==$("#userPassConfirm").val()?$.ajax({url:"/register",method:"post",dataType:"json",data:{login:$("#userName").val(),email:$("#userLogin").val(),password:$("#userPass").val(),csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){e.is_reg?(setCookie("logged",e.is_logged),userIsLogin=Boolean(getCookie("logged")),$.ajax({url:"/user",method:"get",dataType:"html",success:function(e){$.ajax({url:"/user",method:"get",dataType:"html",success:function(e){$(".window__close").trigger("click"),$(".main").html(e),checkAuth(userIsLogin)}})}}),console.log(e.user)):$("#message").text(e.message).css("display","block")}}):$("#message").text("пароли не совпадают").css("display","block")})}})}),$("#exit").on("click",()=>{$.ajax({url:"/exit",method:"post",data:{csrfmiddlewaretoken:getCookie("csrftoken")},success:function(e){setCookie("logged",!1),userIsLogin=getCookie("logged"),window.location.href="/",checkAuth(userIsLogin)}})})}function checkAuth(e){(e="true"==e)?($(".unlogin").css("display","none"),$(".login").css("display","block")):($(".unlogin").css("display","block"),$(".login").css("display","none"))}function getCookie(e){let o=null;if(document.cookie&&""!==document.cookie){const s=document.cookie.split(";");for(let t=0;t<s.length;t++){const n=s[t].trim();if(n.substring(0,e.length+1)===e+"="){o=decodeURIComponent(n.substring(e.length+1));break}}}return o}function setCookie(e,o,s={}){(s={path:"/",...s}).expires instanceof Date&&(s.expires=s.expires.toUTCString());let t=encodeURIComponent(e)+"="+encodeURIComponent(o);for(let e in s){t+="; "+e;let o=s[e];!0!==o&&(t+="="+o)}document.cookie=t}window.onload=()=>{$.ajax({url:"/auth",methos:"post",data:{csrfmiddlewaretoken:getCookie("csrftoken")},async:!1,success:function(e){setCookie("logged",e.logged),userIsLogin=getCookie("logged")}}),checkAuth(userIsLogin),initEventHandlers()};